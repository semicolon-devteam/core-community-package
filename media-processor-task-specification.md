# Media-Processor ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°œë°œ ì—…ë¬´ì§€ì‹œì„œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**ëª©í‘œ**: í´ë¼ìš°ë“œí”Œë ˆì–´ íƒ€ì„ì•„ì›ƒ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ë¹„ë™ê¸° íŒŒì¼ ì—…ë¡œë“œ ì‹œìŠ¤í…œ êµ¬í˜„

**ë°°ê²½**: í˜„ì¬ ë™ê¸°ì‹ íŒŒì¼ ì—…ë¡œë“œë¡œ ì¸í•´ ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹œ í´ë¼ìš°ë“œí”Œë ˆì–´ì—ì„œ íƒ€ì„ì•„ì›ƒ ë°œìƒ. ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í†µí•´ ì‚¬ìš©ì ê²½í—˜ ê°œì„  ë° ì•ˆì •ì„± í™•ë³´ í•„ìš”.

## ğŸ¯ í•µì‹¬ ìš”êµ¬ì‚¬í•­

### 1. ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸ ê°œë°œ

#### 1.1 POST `/api/media/upload-async`
**ìš”ì²­ í˜•ì‹**:
```json
{
  "postId": 123,
  "files": [
    {
      "fileName": "sample_image.jpg",
      "fileSize": 3145728,
      "fileType": "image/jpeg",
      "uuid": "file-uuid-1",
      "base64Data": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    }
  ]
}
```

**ì‘ë‹µ í˜•ì‹**:
```json
{
  "success": true,
  "message": "íŒŒì¼ ì—…ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤",
  "uploadId": "upload-session-uuid",
  "files": [
    {
      "uuid": "file-uuid-1",
      "status": "pending"
    }
  ]
}
```

#### 1.2 GET `/api/media/upload-progress/{postId}`
**ì‘ë‹µ í˜•ì‹**:
```json
{
  "postId": 123,
  "overallProgress": 75,
  "files": [
    {
      "fileName": "sample_image.jpg",
      "fileSize": 3145728,
      "fileType": "image/jpeg",
      "fullPath": "/uploads/images/sample_image.jpg",
      "uuid": "file-uuid-1",
      "url": "/storage/uploads/images/sample_image.jpg",
      "thumbnailUrl": "/storage/uploads/images/thumbnails/sample_image_thumb.jpg",
      "status": "completed",
      "progress": 100,
      "uploadedAt": "2024-01-15T10:30:00Z"
    },
    {
      "fileName": "large_video.mp4",
      "fileSize": 27262976,
      "fileType": "video/mp4",
      "fullPath": "/uploads/videos/large_video.mp4",
      "uuid": "file-uuid-2",
      "url": "/storage/uploads/videos/large_video.mp4",
      "thumbnailUrl": "/storage/uploads/videos/thumbnails/large_video_thumb.jpg",
      "status": "watermarking",
      "progress": 75,
      "uploadedAt": null
    }
  ]
}
```

### 2. íŒŒì¼ ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš°

#### 2.1 ìƒíƒœ ê´€ë¦¬
íŒŒì¼ë³„ ìƒíƒœë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ê´€ë¦¬:
- `pending`: ì—…ë¡œë“œ ëŒ€ê¸°
- `uploading`: ìˆ˜íŒŒë² ì´ìŠ¤ ì—…ë¡œë“œ ì¤‘
- `watermarking`: ì›Œí„°ë§ˆí¬ ì²˜ë¦¬ ì¤‘ (ì´ë¯¸ì§€/ë¹„ë””ì˜¤)
- `completed`: ì™„ë£Œ
- `failed`: ì‹¤íŒ¨

#### 2.2 ì²˜ë¦¬ ë‹¨ê³„
1. **íŒŒì¼ ìˆ˜ì‹  ë° ê²€ì¦**
   - íŒŒì¼ í¬ê¸°, í˜•ì‹ ê²€ì¦
   - ì¤‘ë³µ íŒŒì¼ ì²´í¬
   - UUID ê¸°ë°˜ ì„ì‹œ ì €ì¥

2. **ìˆ˜íŒŒë² ì´ìŠ¤ ì—…ë¡œë“œ**
   - ì²­í¬ ë‹¨ìœ„ ì—…ë¡œë“œë¡œ progress ì¶”ì 
   - ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ)
   - ì—…ë¡œë“œ ì™„ë£Œ ì‹œ URL ìƒì„±

3. **í›„ì²˜ë¦¬**
   - **ì´ë¯¸ì§€**: ì¸ë„¤ì¼ ìƒì„±, ì›Œí„°ë§ˆí¬ ì¶”ê°€
   - **ë¹„ë””ì˜¤**: ì¸ë„¤ì¼ ì¶”ì¶œ, ì›Œí„°ë§ˆí¬ ì¶”ê°€
   - **ê¸°íƒ€ íŒŒì¼**: ë°”ë¡œ ì™„ë£Œ ì²˜ë¦¬

4. **ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸**
   - posts í…Œì´ë¸”ì˜ attachments í•„ë“œ(JSON) ì—…ë°ì´íŠ¸
   - ëª¨ë“  íŒŒì¼ ì™„ë£Œ ì‹œ posts.statusë¥¼ NULL â†’ DRAFTë¡œ ë³€ê²½

### 3. ê¸°ìˆ  ìŠ¤í™

#### 3.1 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
ê¸°ì¡´ posts í…Œì´ë¸” í™œìš©:
```sql
-- posts í…Œì´ë¸”ì˜ attachments ì»¬ëŸ¼ (JSON íƒ€ì…)
-- ì˜ˆì‹œ ë°ì´í„°:
[
  {
    "fileName": "sample_image.jpg",
    "fileSize": 3145728,
    "fileType": "image/jpeg",
    "fullPath": "/uploads/images/sample_image.jpg",
    "uuid": "file-uuid-1",
    "url": "/storage/uploads/images/sample_image.jpg",
    "thumbnailUrl": "/storage/uploads/images/thumbnails/sample_image_thumb.jpg",
    "status": "completed",
    "progress": 100,
    "uploadedAt": "2024-01-15T10:30:00Z"
  }
]
```

#### 3.2 Redis ìºì‹±
ì—…ë¡œë“œ ì§„í–‰ë„ ì‹¤ì‹œê°„ ì¶”ì ì„ ìœ„í•œ Redis í™œìš©:
```
Key: upload_progress:{postId}
Value: JSON (ìœ„ ì‘ë‹µ í˜•ì‹ê³¼ ë™ì¼)
TTL: 1ì‹œê°„
```

#### 3.3 í ì‹œìŠ¤í…œ
íŒŒì¼ë³„ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì‘ì—… í:
- í ì´ë¦„: `file_processing_queue`
- ì‘ì—…ì(Worker) ìˆ˜: 3-5ê°œ ë³‘ë ¬ ì²˜ë¦¬
- ì¬ì‹œë„: ìµœëŒ€ 3íšŒ, ì§€ìˆ˜ ë°±ì˜¤í”„

### 4. ì—ëŸ¬ ì²˜ë¦¬

#### 4.1 íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨
```json
{
  "fileName": "failed_file.jpg",
  "status": "failed",
  "progress": 0,
  "error": "íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜"
}
```

#### 4.2 ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤
- **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**: 3íšŒ ì¬ì‹œë„ í›„ ì‹¤íŒ¨ ì²˜ë¦¬
- **íŒŒì¼ ì†ìƒ**: ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬, ì‚¬ìš©ìì—ê²Œ ì¬ì—…ë¡œë“œ ìš”ì²­
- **ìš©ëŸ‰ ì´ˆê³¼**: ì¦‰ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬, ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€

### 5. ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­

#### 5.1 ì‘ë‹µ ì‹œê°„
- ë¹„ë™ê¸° ì—…ë¡œë“œ ì‹œì‘: < 3ì´ˆ
- ì§„í–‰ë„ ì¡°íšŒ: < 1ì´ˆ
- ëŒ€ìš©ëŸ‰ íŒŒì¼(100MB): 5ë¶„ ì´ë‚´ ì™„ë£Œ

#### 5.2 ë™ì‹œ ì²˜ë¦¬
- ë™ì‹œ ì—…ë¡œë“œ ì„¸ì…˜: ìµœëŒ€ 100ê°œ
- íŒŒì¼ë³„ ë³‘ë ¬ ì²˜ë¦¬: ìµœëŒ€ 5ê°œ
- ì§„í–‰ë„ ì¡°íšŒ: ë¬´ì œí•œ (ìºì‹± í™œìš©)

### 6. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

#### 6.1 íŒŒì¼ ê²€ì¦
- íŒŒì¼ ì‹œê·¸ë‹ˆì²˜ ê²€ì¦ (ë§¤ì§ ë„˜ë²„)
- ì•…ì„± ì½”ë“œ ìŠ¤ìº” (ì„ íƒì‚¬í•­)
- íŒŒì¼ í¬ê¸° ì œí•œ: ì´ë¯¸ì§€ 10MB, ë¹„ë””ì˜¤ 100MB

#### 6.2 ì¸ì¦
- JWT í† í° ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦
- postId ì†Œìœ ê¶Œ ê²€ì¦
- API ìš”ì²­ ì œí•œ (Rate Limiting)

## ğŸš€ êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ API ê°œë°œ (1ì£¼)
- [ ] ë¹„ë™ê¸° ì—…ë¡œë“œ API ê°œë°œ
- [ ] ì§„í–‰ë„ ì¡°íšŒ API ê°œë°œ
- [ ] Redis ì—°ë™
- [ ] ê¸°ë³¸ ì—ëŸ¬ ì²˜ë¦¬

### Phase 2: íŒŒì¼ ì²˜ë¦¬ ë¡œì§ (1ì£¼)
- [ ] ìˆ˜íŒŒë² ì´ìŠ¤ ì—…ë¡œë“œ ë¡œì§
- [ ] ì´ë¯¸ì§€/ë¹„ë””ì˜¤ í›„ì²˜ë¦¬
- [ ] í ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] ì¬ì‹œë„ ë¡œì§

### Phase 3: ìµœì í™” ë° í…ŒìŠ¤íŠ¸ (0.5ì£¼)
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸
- [ ] ë¬¸ì„œí™”

## ğŸ“ ì°¸ê³ ì‚¬í•­

### ê¸°ì¡´ ì‹œìŠ¤í…œ ì—°ë™
í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
- FileAttachment ì¸í„°í˜ì´ìŠ¤ í™•ì¥ ì™„ë£Œ
- ì§„í–‰ë„ UI ì»´í¬ë„ŒíŠ¸ ì™„ì„±
- 2ì´ˆ ê°„ê²© í´ë§ ë¡œì§ êµ¬í˜„

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ì •ìƒ ì¼€ì´ìŠ¤**: ì´ë¯¸ì§€ + ë¹„ë””ì˜¤ í˜¼í•© ì—…ë¡œë“œ
2. **ëŒ€ìš©ëŸ‰ íŒŒì¼**: 100MB ë¹„ë””ì˜¤ íŒŒì¼
3. **ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •**: ì¤‘ê°„ì— ì—°ê²° ëŠê¹€
4. **ë™ì‹œ ì—…ë¡œë“œ**: ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ë™ì‹œ ì—…ë¡œë“œ

### ëª¨ë‹ˆí„°ë§
- ì—…ë¡œë“œ ì„±ê³µë¥ 
- í‰ê·  ì²˜ë¦¬ ì‹œê°„
- ì—ëŸ¬ìœ¨ ë° ì—ëŸ¬ ìœ í˜•
- í ëŒ€ê¸° ì‹œê°„

## âœ… ì™„ë£Œ ê¸°ì¤€

1. ëª¨ë“  APIê°€ ëª…ì„¸ëŒ€ë¡œ ë™ì‘
2. ì§„í–‰ë„ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì •í™•íˆ ì¶”ì ë¨
3. ì—ëŸ¬ ë°œìƒ ì‹œ ì ì ˆí•œ ë³µêµ¬ ë° ë©”ì‹œì§€ ì œê³µ
4. ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
5. í”„ë¡ íŠ¸ì—”ë“œì™€ ì •ìƒ ì—°ë™ í™•ì¸

---

**ë‹´ë‹¹íŒ€**: Media-Processor ê°œë°œíŒ€  
**ìš°ì„ ìˆœìœ„**: ë†’ìŒ  
**ì™„ë£Œ ëª©í‘œì¼**: 2ì£¼ ì´ë‚´  
**ë¦¬ë·°ì–´**: ë°±ì—”ë“œ íŒ€ì¥, í”„ë¡ íŠ¸ì—”ë“œ íŒ€ì¥